syntax = "proto3";

package entities;

option go_package = "github.com/rusgainew/tunduck-app-mk/proto-lib/entities";

import "google/protobuf/wrappers.proto";
import "dictionaries/reference_item.proto";
import "dictionaries/vat_tax_type.proto";
import "dictionaries/country.proto";
import "entities/party.proto";
import "entities/invoice_financial.proto";
import "entities/invoice_international.proto";
import "entities/invoice_contract.proto";

// Invoice представляет счет-фактуру (налоговый документ).
// Основной документ в системе электронных счетов-фактур (ЭСФ) ТУНДУК.
//
// Существует три типа счетов-фактур:
//  1. Счет-фактура на реализацию (СФ-РЕ): Поставка товаров/услуг продавцом покупателю
//  2. Счет-фактура на приобретение (СФ-ПР): Получение товаров/услуг покупателем
//  3. Корректировочный счет-фактура (КСФ): Уточнение ошибок в предыдущих счетах
//
// Счет-фактура содержит полную информацию о товарах/услугах, сторонах сделки,
// налогах, платежах и других реквизитах, необходимых для ведения учета
// в соответствии с законодательством Кыргызской Республики.
//
// Жизненный цикл документа:
//	Черновик → Отправлено → Одобрено/Отклонено → Подписано → (опционально: Отозвано)
message Invoice {
  // DocumentUUID - Уникальный универсальный идентификатор документа.
  // Генерируется системой при создании документа и остается неизменным
  // на протяжении всего жизненного цикла документа.
  // Используется для однозначной идентификации в системе ТУНДУК.
  // Формат: UUID (например, "550e8400-e29b-41d4-a716-446655440000")
  string document_uuid = 1;

  // InvoiceNumber - Номер счета-фактуры.
  // Порядковый номер документа, присваиваемый поставщиком/продавцом.
  // Может быть в формате "СФ-001", "001-2024", и т.д., в зависимости от
  // внутренней нумерации организации.
  string invoice_number = 2;

  // Number - Дополнительный номер или код документа.
  // Может использоваться для внутренней идентификации или связи с
  // другими системами (CRM, ERP и т.д.).
  string number = 3;

  // CorrectedReceiptUUID - UUID корректируемого документа.
  // Заполняется только для корректировочных счетов (КСФ).
  // Содержит UUID счета, который исправляется/корректируется.
  // Для обычных счетов пусто.
  string corrected_receipt_uuid = 4;

  // InvoiceDate - Дата составления счета-фактуры (подписания).
  // Дата, когда документ был подготовлен и подписан.
  // Формат: ISO 8601 (YYYY-MM-DD), например "2024-01-15"
  // Может быть nil, если дата еще не установлена.
  google.protobuf.StringValue invoice_date = 5;

  // CreatedDate - Дата создания документа в системе.
  // Системная дата, когда документ был впервые создан.
  // Обычно совпадает с InvoiceDate или немного позже (время разницы).
  // Формат: ISO 8601 (YYYY-MM-DD), например "2024-01-15"
  google.protobuf.StringValue created_date = 6;

  // DeliveryDate - Дата фактической поставки товаров/оказания услуг.
  // День, когда товары/услуги были получены покупателем.
  // Может отличаться от InvoiceDate, если есть отсрочка доставки.
  // Формат: ISO 8601 (YYYY-MM-DD), например "2024-01-20"
  // Может быть nil для услуг без физической доставки.
  google.protobuf.StringValue delivery_date = 7;

  // CorrecteReceiptCreationDate - Дата создания корректируемого документа.
  // Для корректировочных счетов содержит дату создания оригинального счета.
  // Для обычных счетов пусто.
  // Формат: ISO 8601 (YYYY-MM-DD)
  google.protobuf.StringValue corrected_receipt_creation_date = 8;

  // TotalAmount - Общая сумма счета-фактуры.
  // Включает все суммы: базовую стоимость, НДС, НСП и другие налоги.
  // Выражается в сомах Кыргызской Республики или другой валюте (см. Currency).
  // Пример: 15500.00 (15 500 сомов)
  double total_amount = 9;

  // IsResident - Флаг резидентства юридического лица (продавца).
  // Используется для внутренних операций.
  // Для всех международных операций используйте InternationalData.
  bool is_resident = 10;

  // Note - Примечание/комментарий к счету-фактуре.
  // Дополнительная информация, комментарии от поставщика/продавца.
  // Может содержать условия платежа, специальные указания и т.д.
  // Необязательное поле, может быть пусто.
  string note = 11;

  // OwnedCrmReceiptCode - Код документа в системе CRM поставщика.
  // Используется для связи с внешней CRM/ERP системой.
  // Позволяет отслеживать документы в обеих системах параллельно.
  string owned_crm_receipt_code = 12;

  // CorrectedReceiptCode - Номер оригинального счета-фактуры.
  // Для КСФ содержит номер счета, который корректируется.
  // Для обычных счетов пусто.
  string corrected_receipt_code = 13;

  // CorrectionReasonCode - Код причины корректировки.
  // Классификатор, определяющий причину изменения.
  // Примеры: "PRICE_ERROR" (ошибка в цене), "QUANTITY_ERROR" (ошибка в количестве)
  // Заполняется только для КСФ.
  string correction_reason_code = 14;

  // CorrectionReasonName - Текстовое описание причины корректировки.
  // Человеческое объяснение, почему был создан корректировочный счет.
  // Примеры: "Исправление ошибки в цене товара", "Уточнение количества"
  // Заполняется только для КСФ.
  string correction_reason_name = 15;

  // IsPriceWithoutTaxes - Флаг, указывает ли базовая цена на исключение налогов.
  // true: базовая цена уже без НДС/НСП (налоги добавляются сверху)
  // false: базовая цена включает все налоги
  // Важно для правильного расчета и отображения стоимости товаров.
  bool is_price_without_taxes = 16;

  // IsIndustry - Флаг отнесения товаров/услуг к отраслевым.
  // true: товары/услуги относятся к определенной отрасли (используется спецрежим)
  // false: обычная торговля
  bool is_industry = 17;

  // ========== СГРУППИРОВАННЫЕ ДАННЫЕ ==========

  // FinancialData - Финансовые данные счета-фактуры.
  // Включает суммы, банковские реквизиты и данные для специальных документов.
  FinancialData financial_data = 18;

  // InternationalData - Данные для международных операций.
  // Используется для операций с иностранными партнерами.
  InternationalData international_data = 19;

  // ContractData - Данные контракта/договора.
  // Информация о договоре поставки, на основе которого создан счет.
  ContractData contract_data = 20;

  // Справочные объекты
  dictionaries.ReferenceItem status = 33;
  dictionaries.ReferenceItem currency = 34;
  dictionaries.ReferenceItem payment_type = 35;
  dictionaries.ReferenceItem receipt_type = 36;
  dictionaries.ReferenceItem delivery_type = 37;
  dictionaries.ReferenceItem vat_delivery = 38;
  dictionaries.VATTaxType vat_tax_type = 39;

  // Стороны сделки
  Party legal_person = 40;
  Party contractor = 41;

  // Географическая информация
  dictionaries.Country country = 42;
}